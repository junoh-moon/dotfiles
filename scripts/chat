#!/usr/bin/env sh

MODEL=gpt-3.5-turbo
#MODEL=gpt-4

if [ $# -gt 0 ]; then
	CONTENT="$*"
elif [ -t 0 ]; then  # STDIN is a terminal (keyboard input)
	printf "Enter prompt: "
	read CONTENT
else  # "STDIN is piped or redirected from a different source"
	CONTENT="$(cat)"
fi

curl -s https://api.openai.com/v1/chat/completions \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -d @- <<EOF \
  | jq '.choices[0].message.content' \
  | xargs -0 printf \
  | glow
{
     "model": "$MODEL",
     "messages": [
		 {
			 "role": "user",
			 "content": "$CONTENT"
		 }
	 ]
}
EOF
